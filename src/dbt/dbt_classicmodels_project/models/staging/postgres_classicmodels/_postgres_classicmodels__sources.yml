version: 2

sources:
  - name: postgres_classicmodels
    description: "Raw data tables from the classicmodels sample database in PostgreSQL."
    database: "{{ env_var('DBT_RAW_DATABASE', 'OLTPDB') }}" # Database chứa dữ liệu gốc
    schema: public # Schema chứa dữ liệu gốc

    # freshness: # Ví dụ kiểm tra độ tươi mới
    #   warn_after: {count: 12, period: hour}
    #   error_after: {count: 24, period: hour}
    # loaded_at_field: "_loaded_at" # Cột chứa timestamp khi dữ liệu được tải

    tables:
      - name: customers
        # description: ...
        columns:
          - name: customernumber
            tests:
              - unique
              - not_null
          - name: customername
            tests:
              - not_null
          - name: salesrepemployeenumber
            tests:
              - relationships:
                  to: source('postgres_classicmodels', 'employees')
                  field: employeenumber
      - name: orders
        columns:
          - name: ordernumber
            tests:
              - unique
              - not_null
          - name: customernumber
            tests:
              - not_null
              - relationships:
                  to: source('postgres_classicmodels', 'customers')
                  field: customernumber
          - name: orderdate
            tests:
              - not_null
      - name: orderdetails
        columns:
          - name: ordernumber
            tests:
              - not_null
              - relationships:
                  to: source('postgres_classicmodels', 'orders')
                  field: ordernumber
          - name: productcode
            tests:
              - not_null
              - relationships:
                  to: source('postgres_classicmodels', 'products')
                  field: productcode
          - name: quantityordered
            tests:
              - not_null
          - name: priceeach
            tests:
              - not_null
      - name: products
        columns:
          - name: productcode
            tests:
              - unique
              - not_null
          - name: productline
            tests:
              - not_null
              - relationships:
                  to: source('postgres_classicmodels', 'productlines')
                  field: productline
      - name: productlines
        columns:
          - name: productline
            tests:
              - unique
              - not_null
      - name: employees
        columns:
          - name: employeenumber
            tests:
              - unique
              - not_null
          - name: reportsto
            tests:
              - relationships:
                  to: source('postgres_classicmodels', 'employees')
                  field: employeenumber # FK tự tham chiếu
          - name: officecode
            tests:
              - not_null
              - relationships:
                  to: source('postgres_classicmodels', 'offices')
                  field: officecode
      - name: offices
        columns:
          - name: officecode
            tests:
              - unique
              - not_null
      - name: payments
        columns:
          - name: customernumber
            tests:
              - not_null
              - relationships:
                  to: source('postgres_classicmodels', 'customers')
                  field: customernumber
          - name: checknumber
            tests:
              - not_null # Part of potential composite key?
          - name: amount
            tests:
              - not_null
        # Add descriptions for tables and columns for better documentation
